<div class="transactions">
  <div class="header">
    <div>
      <h2>Stock Transactions</h2>
      <p class="muted">Receive, issue, transfer, or adjust inventory with audit-ready references.</p>
    </div>
    <a mat-stroked-button color="primary" routerLink="/inventory/overview">
      <mat-icon>insights</mat-icon>
      Stock overview
    </a>
  </div>

  @if (message()) {
  <div class="flash" role="status" aria-live="polite">
    <mat-icon color="primary">check_circle</mat-icon>
    <span>{{ message() }}</span>
  </div>
  }
  @if (error()) {
  <div class="flash error" role="alert" aria-live="assertive">
    <mat-icon color="warn">error</mat-icon>
    <span>{{ error() }}</span>
  </div>
  }

  @if (loading()) {
  <div class="loading-banner">
    <app-loading message="Processing transaction..." />
  </div>
  }

  <mat-tab-group>
    <mat-tab label="Receive">
      <mat-card>
        <form [formGroup]="receiveForm" class="form-grid" (ngSubmit)="submitReceive()">
          <mat-form-field appearance="outline">
            <mat-label>Product</mat-label>
            <mat-select formControlName="productId" required>
              @for (p of products(); track trackProduct($index, p)) {
              <mat-option [value]="p.id">{{ p.name }} - {{ p.sku }}</mat-option>
              }
            </mat-select>
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Warehouse</mat-label>
            <mat-select formControlName="warehouseId" required>
              @for (w of warehouses(); track trackWarehouse($index, w)) {
              <mat-option [value]="w.id">{{ w.name }} ({{ w.code }})</mat-option>
              }
            </mat-select>
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Location (optional)</mat-label>
            <mat-select formControlName="locationId">
              <mat-option [value]="null">Not specified</mat-option>
              @for (l of locations(); track trackLocation($index, l)) {
              <mat-option [value]="l.id">{{ l.code }}</mat-option>
              }
            </mat-select>
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Quantity</mat-label>
            <input matInput type="number" min="1" formControlName="quantity" />
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Unit cost</mat-label>
            <input matInput type="number" min="0" step="0.01" formControlName="unitCost" />
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Reference type</mat-label>
            <input matInput formControlName="referenceType" placeholder="e.g. PO" />
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Reference id</mat-label>
            <input matInput formControlName="referenceId" placeholder="PO-12345" />
          </mat-form-field>

          <div class="actions">
            <button mat-raised-button color="primary" type="submit" [disabled]="receiveForm.invalid || loading()">
              Receive
            </button>
          </div>
        </form>
      </mat-card>
    </mat-tab>

    <mat-tab label="Issue">
      <mat-card>
        <form [formGroup]="issueForm" class="form-grid" (ngSubmit)="submitIssue()">
          <mat-form-field appearance="outline">
            <mat-label>Product</mat-label>
            <mat-select formControlName="productId" required>
              @for (p of products(); track trackProduct($index, p)) {
              <mat-option [value]="p.id">{{ p.name }} - {{ p.sku }}</mat-option>
              }
            </mat-select>
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Warehouse</mat-label>
            <mat-select formControlName="warehouseId" required>
              @for (w of warehouses(); track trackWarehouse($index, w)) {
              <mat-option [value]="w.id">{{ w.name }} ({{ w.code }})</mat-option>
              }
            </mat-select>
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Location (optional)</mat-label>
            <mat-select formControlName="locationId">
              <mat-option [value]="null">Not specified</mat-option>
              @for (l of locations(); track trackLocation($index, l)) {
              <mat-option [value]="l.id">{{ l.code }}</mat-option>
              }
            </mat-select>
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Quantity</mat-label>
            <input matInput type="number" min="1" formControlName="quantity" />
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Reference type</mat-label>
            <input matInput formControlName="referenceType" placeholder="e.g. SO" />
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Reference id</mat-label>
            <input matInput formControlName="referenceId" placeholder="SO-12345" />
          </mat-form-field>

          <div class="actions">
            <button mat-raised-button color="primary" type="submit" [disabled]="issueForm.invalid || loading()">
              Issue
            </button>
          </div>
        </form>
      </mat-card>
    </mat-tab>

    <mat-tab label="Transfer">
      <mat-card>
        <form [formGroup]="transferForm" class="form-grid" (ngSubmit)="submitTransfer()">
          <mat-form-field appearance="outline">
            <mat-label>Product</mat-label>
            <mat-select formControlName="productId" required>
              @for (p of products(); track trackProduct($index, p)) {
              <mat-option [value]="p.id">{{ p.name }} - {{ p.sku }}</mat-option>
              }
            </mat-select>
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>From warehouse</mat-label>
            <mat-select formControlName="fromWarehouseId" required>
              @for (w of warehouses(); track trackWarehouse($index, w)) {
              <mat-option [value]="w.id">{{ w.name }} ({{ w.code }})</mat-option>
              }
            </mat-select>
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>From location</mat-label>
            <mat-select formControlName="fromLocationId">
              <mat-option [value]="null">Not specified</mat-option>
              @for (l of fromLocations(); track trackLocation($index, l)) {
              <mat-option [value]="l.id">{{ l.code }}</mat-option>
              }
            </mat-select>
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>To warehouse</mat-label>
            <mat-select formControlName="toWarehouseId" required>
              @for (w of warehouses(); track trackWarehouse($index, w)) {
              <mat-option [value]="w.id">{{ w.name }} ({{ w.code }})</mat-option>
              }
            </mat-select>
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>To location</mat-label>
            <mat-select formControlName="toLocationId">
              <mat-option [value]="null">Not specified</mat-option>
              @for (l of toLocations(); track trackLocation($index, l)) {
              <mat-option [value]="l.id">{{ l.code }}</mat-option>
              }
            </mat-select>
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Quantity</mat-label>
            <input matInput type="number" min="1" formControlName="quantity" />
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Reference type</mat-label>
            <input matInput formControlName="referenceType" placeholder="e.g. Transfer" />
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Reference id</mat-label>
            <input matInput formControlName="referenceId" />
          </mat-form-field>

          <div class="actions">
            <button mat-raised-button color="primary" type="submit" [disabled]="transferForm.invalid || loading()">
              Transfer
            </button>
          </div>
        </form>
      </mat-card>
    </mat-tab>

    <mat-tab label="Adjust">
      <mat-card>
        <form [formGroup]="adjustForm" class="form-grid" (ngSubmit)="submitAdjust()">
          <mat-form-field appearance="outline">
            <mat-label>Product</mat-label>
            <mat-select formControlName="productId" required>
              @for (p of products(); track trackProduct($index, p)) {
              <mat-option [value]="p.id">{{ p.name }} - {{ p.sku }}</mat-option>
              }
            </mat-select>
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Warehouse</mat-label>
            <mat-select formControlName="warehouseId" required>
              @for (w of warehouses(); track trackWarehouse($index, w)) {
              <mat-option [value]="w.id">{{ w.name }} ({{ w.code }})</mat-option>
              }
            </mat-select>
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Location (optional)</mat-label>
            <mat-select formControlName="locationId">
              <mat-option [value]="null">Not specified</mat-option>
              @for (l of locations(); track trackLocation($index, l)) {
              <mat-option [value]="l.id">{{ l.code }}</mat-option>
              }
            </mat-select>
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Delta quantity (+/-)</mat-label>
            <input matInput type="number" formControlName="deltaQuantity" />
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Reason</mat-label>
            <input matInput formControlName="reason" />
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Reference type</mat-label>
            <input matInput formControlName="referenceType" placeholder="e.g. Audit" />
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Reference id</mat-label>
            <input matInput formControlName="referenceId" />
          </mat-form-field>

          <div class="actions">
            <button mat-raised-button color="primary" type="submit" [disabled]="adjustForm.invalid || loading()">
              Adjust
            </button>
          </div>
        </form>
      </mat-card>
    </mat-tab>
  </mat-tab-group>
</div>
